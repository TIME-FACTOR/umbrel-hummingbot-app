# Use ${APP_DATA_DIR} for paths so compose works when Umbrel merges multiple -f files.
# app_proxy uses the same getumbrel image as other apps (no custom build) so the dashboard
# shows the app as running and the tile works.
services:
  app_proxy:
    image: getumbrel/app-proxy:1.0.0@sha256:49eb600c4667c4b948055e33171b42a509b7e0894a77e0ca40df8284c77b52fb
    container_name: mystore-hummingbot_app_proxy_1
    hostname: app_proxy_mystore-hummingbot
    networks:
      - default
      - umbrel_main
    restart: unless-stopped
    volumes:
      - ${APP_DATA_DIR}/umbrel-app.yml:/extra/umbrel-app.yml:ro
      - ${TOR_DATA_DIR}:/var/lib/tor:ro
      - ${APP_DATA_DIR}:/data:ro
    environment:
      APP_HOST: mystore-hummingbot_info_1
      APP_PORT: "80"
      PROXY_PORT: ${APP_PROXY_PORT}
      AUTH_SERVICE_PORT: ${AUTH_PORT}
      UMBREL_AUTH_SECRET: ${UMBREL_AUTH_SECRET}
      MANAGER_IP: ${MANAGER_IP}
      MANAGER_PORT: ${MANAGER_PORT:-3006}
      JWT_SECRET: ${JWT_SECRET}
      PROXY_AUTH_ADD: "true"

  info:
    image: nginx:alpine
    container_name: mystore-hummingbot_info_1
    volumes:
      - ${APP_DATA_DIR}/info-page:/usr/share/nginx/html:ro
      - ${APP_DATA_DIR}/info-page/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped

  hummingbot:
    build:
      context: ${APP_DATA_DIR}
      dockerfile: Dockerfile
    image: mystore-hummingbot:developer
    container_name: mystore-hummingbot_hummingbot_1
    tty: true
    stdin_open: true
    volumes:
      - ${APP_DATA_DIR}/source:/home/hummingbot/source
      - ${APP_DATA_DIR}/conf:/home/hummingbot/conf
      - ${APP_DATA_DIR}/logs:/home/hummingbot/logs
      - ${APP_DATA_DIR}/data:/home/hummingbot/data
      - ${APP_DATA_DIR}/certs:/home/hummingbot/certs
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
    restart: unless-stopped

  gateway:
    image: hummingbot/gateway:latest
    container_name: mystore-hummingbot_gateway_1
    ports:
      - "15888:15888"
    volumes:
      - ${APP_DATA_DIR}/gateway-files/conf:/home/gateway/conf
      - ${APP_DATA_DIR}/gateway-files/logs:/home/gateway/logs
      - ${APP_DATA_DIR}/certs:/home/gateway/certs
    environment:
      - GATEWAY_PASSPHRASE=admin
      - DEV=true
    restart: unless-stopped
    profiles:
      - gateway

networks:
  umbrel_main:
    name: umbrel_main_network
    external: true
